TODO: Implement unit tests for all new features